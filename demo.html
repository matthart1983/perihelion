<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading System Architecture | Perihelion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a1628;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .architecture-container {
            width: 100%;
            min-height: 100vh;
            position: relative;
            padding: 40px;
        }

        .architecture-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .architecture-header h2 {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .architecture-header p {
            color: rgba(255,255,255,0.5);
            font-size: 0.875rem;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .status-dot.warning {
            background: #f59e0b;
        }

        .status-dot.critical {
            background: #ef4444;
            animation: pulse-critical 1s infinite;
        }

        @keyframes pulse-critical {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
        }

        .architecture-canvas {
            position: relative;
            width: 100%;
            max-width: 1400px;
            height: 700px;
            margin: 0 auto;
        }

        /* SVG for connections */
        .connections-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* Node styling */
        .node {
            position: absolute;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .node:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .node-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .node-title {
            color: #fff;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .node-subtitle {
            color: rgba(255,255,255,0.5);
            font-size: 0.7rem;
        }

        .node-metrics {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .metric {
            display: flex;
            flex-direction: column;
        }

        .metric-value {
            color: #fff;
            font-size: 0.875rem;
            font-weight: 600;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .metric-label {
            color: rgba(255,255,255,0.4);
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-value.good { color: #10b981; }
        .metric-value.warning { color: #f59e0b; }
        .metric-value.critical { color: #ef4444; }

        /* Node type colors */
        .node.external .node-icon { background: rgba(139, 92, 246, 0.2); }
        .node.gateway .node-icon { background: rgba(59, 130, 246, 0.2); }
        .node.core .node-icon { background: rgba(16, 185, 129, 0.2); }
        .node.data .node-icon { background: rgba(245, 158, 11, 0.2); }
        .node.risk .node-icon { background: rgba(239, 68, 68, 0.2); }
        .node.downstream .node-icon { background: rgba(99, 102, 241, 0.2); }

        /* Specific node positions */
        .node.market-data { top: 20px; left: 50px; width: 180px; }
        .node.fix-gateway { top: 20px; left: 280px; width: 180px; }
        .node.client-orders { top: 20px; right: 280px; width: 180px; }
        .node.web-api { top: 20px; right: 50px; width: 180px; }

        .node.oms { top: 180px; left: 200px; width: 200px; }
        .node.ems { top: 180px; right: 200px; width: 200px; }

        .node.matching-engine { top: 340px; left: 50%; transform: translateX(-50%); width: 280px; }

        .node.risk-engine { top: 340px; left: 80px; width: 200px; }
        .node.market-surveillance { top: 340px; right: 80px; width: 200px; }

        .node.position-keeper { top: 500px; left: 150px; width: 180px; }
        .node.trade-db { top: 500px; left: 50%; transform: translateX(-50%); width: 180px; }
        .node.clearing { top: 500px; right: 150px; width: 180px; }

        .node.regulatory { top: 640px; left: 50%; transform: translateX(-50%); width: 220px; }

        /* Data flow particles */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #3b82f6;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            box-shadow: 0 0 10px #3b82f6, 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .particle.order { background: #8b5cf6; box-shadow: 0 0 10px #8b5cf6; }
        .particle.trade { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .particle.risk { background: #ef4444; box-shadow: 0 0 10px #ef4444; }
        .particle.market { background: #f59e0b; box-shadow: 0 0 10px #f59e0b; }

        /* Connection lines */
        .connection {
            stroke: rgba(255,255,255,0.1);
            stroke-width: 1;
            fill: none;
        }

        .connection.active {
            stroke: rgba(59, 130, 246, 0.3);
            stroke-width: 2;
        }

        /* Incident overlay */
        .incident-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 20px;
            max-width: 320px;
            z-index: 100;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .incident-overlay.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .incident-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .incident-icon {
            width: 32px;
            height: 32px;
            background: rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .incident-title {
            color: #ef4444;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .incident-time {
            color: rgba(255,255,255,0.5);
            font-size: 0.7rem;
        }

        .incident-details {
            color: rgba(255,255,255,0.7);
            font-size: 0.8rem;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .blast-radius {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .affected-system {
            padding: 4px 8px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 4px;
            color: #ef4444;
            font-size: 0.7rem;
        }

        /* Legend */
        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255,255,255,0.5);
            font-size: 0.7rem;
        }

        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-line.order { background: #8b5cf6; }
        .legend-line.trade { background: #10b981; }
        .legend-line.risk { background: #ef4444; }
        .legend-line.market { background: #f59e0b; }

        /* Node affected state */
        .node.affected {
            border-color: rgba(239, 68, 68, 0.5);
            animation: node-alert 2s infinite;
        }

        @keyframes node-alert {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.2); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); }
        }

        /* Cascade effect */
        .node.cascade-1 { animation-delay: 0s; }
        .node.cascade-2 { animation-delay: 0.5s; }
        .node.cascade-3 { animation-delay: 1s; }
        .node.cascade-4 { animation-delay: 1.5s; }

        /* Throughput bar */
        .throughput-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            z-index: 100;
        }

        .throughput-title {
            color: rgba(255,255,255,0.5);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .throughput-value {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .throughput-unit {
            color: rgba(255,255,255,0.5);
            font-size: 0.75rem;
        }

        .throughput-chart {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 40px;
            margin-top: 12px;
        }

        .throughput-bar-item {
            flex: 1;
            background: rgba(59, 130, 246, 0.3);
            border-radius: 2px;
            transition: height 0.3s ease;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="architecture-container">
        <div class="architecture-header">
            <h2>Live Trading System Architecture</h2>
            <p>Real-time order flow, risk checks, and trade execution</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot"></div>
                <span>All Systems Operational</span>
            </div>
            <div class="status-item">
                <div class="status-dot warning"></div>
                <span>Latency Warning: Risk Engine</span>
            </div>
            <div class="status-item" id="incidentStatus" style="display: none;">
                <div class="status-dot critical"></div>
                <span>Incident Detected</span>
            </div>
        </div>

        <div class="architecture-canvas" id="canvas">
            <!-- SVG Connection Layer -->
            <svg class="connections-layer" id="connections"></svg>

            <!-- External Layer -->
            <div class="node external market-data" data-id="market-data">
                <div class="node-header">
                    <div class="node-icon">üìä</div>
                    <div>
                        <div class="node-title">Market Data</div>
                        <div class="node-subtitle">External Feed</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value" id="md-rate">1.2M</span>
                        <span class="metric-label">msg/sec</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good" id="md-latency">0.3ms</span>
                        <span class="metric-label">latency</span>
                    </div>
                </div>
            </div>

            <div class="node external fix-gateway" data-id="fix-gateway">
                <div class="node-header">
                    <div class="node-icon">üîå</div>
                    <div>
                        <div class="node-title">FIX Gateway</div>
                        <div class="node-subtitle">Protocol Bridge</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value">42</span>
                        <span class="metric-label">sessions</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good">99.99%</span>
                        <span class="metric-label">uptime</span>
                    </div>
                </div>
            </div>

            <div class="node external client-orders" data-id="client-orders">
                <div class="node-header">
                    <div class="node-icon">üì•</div>
                    <div>
                        <div class="node-title">Client Orders</div>
                        <div class="node-subtitle">Broker Connections</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value" id="order-rate">847</span>
                        <span class="metric-label">orders/sec</span>
                    </div>
                </div>
            </div>

            <div class="node external web-api" data-id="web-api">
                <div class="node-header">
                    <div class="node-icon">üåê</div>
                    <div>
                        <div class="node-title">REST API</div>
                        <div class="node-subtitle">Client Portal</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value">2.1k</span>
                        <span class="metric-label">req/sec</span>
                    </div>
                </div>
            </div>

            <!-- Core Processing Layer -->
            <div class="node core oms" data-id="oms">
                <div class="node-header">
                    <div class="node-icon">üìã</div>
                    <div>
                        <div class="node-title">Order Management</div>
                        <div class="node-subtitle">OMS Core</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value" id="oms-queue">234</span>
                        <span class="metric-label">queued</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good" id="oms-latency">1.2ms</span>
                        <span class="metric-label">p99</span>
                    </div>
                </div>
            </div>

            <div class="node core ems" data-id="ems">
                <div class="node-header">
                    <div class="node-icon">‚ö°</div>
                    <div>
                        <div class="node-title">Execution Management</div>
                        <div class="node-subtitle">Smart Order Router</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value">12</span>
                        <span class="metric-label">venues</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good">0.8ms</span>
                        <span class="metric-label">routing</span>
                    </div>
                </div>
            </div>

            <!-- Matching Engine -->
            <div class="node core matching-engine" data-id="matching-engine">
                <div class="node-header">
                    <div class="node-icon">üéØ</div>
                    <div>
                        <div class="node-title">Matching Engine</div>
                        <div class="node-subtitle">Central Limit Order Book</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value" id="me-matches">4,521</span>
                        <span class="metric-label">matches/sec</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good" id="me-latency">45Œºs</span>
                        <span class="metric-label">match latency</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value">$2.4B</span>
                        <span class="metric-label">daily volume</span>
                    </div>
                </div>
            </div>

            <!-- Risk Layer -->
            <div class="node risk risk-engine" data-id="risk-engine">
                <div class="node-header">
                    <div class="node-icon">üõ°Ô∏è</div>
                    <div>
                        <div class="node-title">Risk Engine</div>
                        <div class="node-subtitle">Pre-Trade Checks</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value warning" id="risk-latency">4.2ms</span>
                        <span class="metric-label">check time</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" id="risk-rejects">23</span>
                        <span class="metric-label">rejects</span>
                    </div>
                </div>
            </div>

            <div class="node risk market-surveillance" data-id="market-surveillance">
                <div class="node-header">
                    <div class="node-icon">üëÅÔ∏è</div>
                    <div>
                        <div class="node-title">Market Surveillance</div>
                        <div class="node-subtitle">Anomaly Detection</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value">3</span>
                        <span class="metric-label">alerts</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good">Normal</span>
                        <span class="metric-label">status</span>
                    </div>
                </div>
            </div>

            <!-- Data Layer -->
            <div class="node data position-keeper" data-id="position-keeper">
                <div class="node-header">
                    <div class="node-icon">üìä</div>
                    <div>
                        <div class="node-title">Position Keeper</div>
                        <div class="node-subtitle">Real-time P&L</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value good">+$1.2M</span>
                        <span class="metric-label">P&L</span>
                    </div>
                </div>
            </div>

            <div class="node data trade-db" data-id="trade-db">
                <div class="node-header">
                    <div class="node-icon">üíæ</div>
                    <div>
                        <div class="node-title">Trade Store</div>
                        <div class="node-subtitle">Persistence Layer</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value" id="db-writes">12k</span>
                        <span class="metric-label">writes/sec</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good">Sync</span>
                        <span class="metric-label">replication</span>
                    </div>
                </div>
            </div>

            <div class="node downstream clearing" data-id="clearing">
                <div class="node-header">
                    <div class="node-icon">üè¶</div>
                    <div>
                        <div class="node-title">Clearing</div>
                        <div class="node-subtitle">CCP Connection</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value good">Connected</span>
                        <span class="metric-label">status</span>
                    </div>
                </div>
            </div>

            <!-- Regulatory -->
            <div class="node downstream regulatory" data-id="regulatory">
                <div class="node-header">
                    <div class="node-icon">üìú</div>
                    <div>
                        <div class="node-title">Regulatory Reporting</div>
                        <div class="node-subtitle">ASIC / MAS / HKMA</div>
                    </div>
                </div>
                <div class="node-metrics">
                    <div class="metric">
                        <span class="metric-value">T+0</span>
                        <span class="metric-label">reporting</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value good">Compliant</span>
                        <span class="metric-label">status</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Throughput Monitor -->
        <div class="throughput-bar">
            <div class="throughput-title">System Throughput</div>
            <div>
                <span class="throughput-value" id="throughput">847,293</span>
                <span class="throughput-unit">msg/sec</span>
            </div>
            <div class="throughput-chart" id="throughputChart">
                <!-- Bars added by JS -->
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-line market"></div>
                <span>Market Data</span>
            </div>
            <div class="legend-item">
                <div class="legend-line order"></div>
                <span>Order Flow</span>
            </div>
            <div class="legend-item">
                <div class="legend-line trade"></div>
                <span>Trade Execution</span>
            </div>
            <div class="legend-item">
                <div class="legend-line risk"></div>
                <span>Risk Check</span>
            </div>
        </div>

        <!-- Incident Overlay -->
        <div class="incident-overlay" id="incidentOverlay">
            <div class="incident-header">
                <div class="incident-icon">‚ö†Ô∏è</div>
                <div>
                    <div class="incident-title">Risk Engine Degradation</div>
                    <div class="incident-time">Detected 3 seconds ago</div>
                </div>
            </div>
            <div class="incident-details">
                Pre-trade risk check latency exceeded 10ms threshold. Order flow automatically throttled. Investigating root cause.
            </div>
            <div class="blast-radius-label" style="color: rgba(255,255,255,0.5); font-size: 0.7rem; margin-bottom: 6px;">BLAST RADIUS</div>
            <div class="blast-radius">
                <span class="affected-system">Order Management</span>
                <span class="affected-system">Execution Management</span>
                <span class="affected-system">Matching Engine</span>
                <span class="affected-system">Client Orders</span>
            </div>
        </div>
    </div>

    <script>
        // Connection definitions
        const connections = [
            { from: 'market-data', to: 'oms', type: 'market' },
            { from: 'market-data', to: 'matching-engine', type: 'market' },
            { from: 'fix-gateway', to: 'oms', type: 'order' },
            { from: 'client-orders', to: 'oms', type: 'order' },
            { from: 'web-api', to: 'ems', type: 'order' },
            { from: 'oms', to: 'risk-engine', type: 'risk' },
            { from: 'oms', to: 'ems', type: 'order' },
            { from: 'ems', to: 'matching-engine', type: 'order' },
            { from: 'risk-engine', to: 'oms', type: 'risk' },
            { from: 'matching-engine', to: 'trade-db', type: 'trade' },
            { from: 'matching-engine', to: 'position-keeper', type: 'trade' },
            { from: 'matching-engine', to: 'clearing', type: 'trade' },
            { from: 'matching-engine', to: 'market-surveillance', type: 'trade' },
            { from: 'trade-db', to: 'regulatory', type: 'trade' },
            { from: 'clearing', to: 'regulatory', type: 'trade' },
        ];

        // Draw connections
        function drawConnections() {
            const svg = document.getElementById('connections');
            const canvas = document.getElementById('canvas');
            svg.innerHTML = '';

            connections.forEach(conn => {
                const fromEl = document.querySelector(`[data-id="${conn.from}"]`);
                const toEl = document.querySelector(`[data-id="${conn.to}"]`);
                
                if (!fromEl || !toEl) return;

                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();

                const x1 = fromRect.left + fromRect.width / 2 - canvasRect.left;
                const y1 = fromRect.top + fromRect.height / 2 - canvasRect.top;
                const x2 = toRect.left + toRect.width / 2 - canvasRect.left;
                const y2 = toRect.top + toRect.height / 2 - canvasRect.top;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const midY = (y1 + y2) / 2;
                path.setAttribute('d', `M ${x1} ${y1} C ${x1} ${midY}, ${x2} ${midY}, ${x2} ${y2}`);
                path.setAttribute('class', `connection ${conn.type}`);
                path.setAttribute('data-from', conn.from);
                path.setAttribute('data-to', conn.to);
                svg.appendChild(path);
            });
        }

        // Particle system
        class Particle {
            constructor(fromId, toId, type) {
                this.fromEl = document.querySelector(`[data-id="${fromId}"]`);
                this.toEl = document.querySelector(`[data-id="${toId}"]`);
                this.type = type;
                this.progress = 0;
                this.speed = 0.01 + Math.random() * 0.015;
                this.element = document.createElement('div');
                this.element.className = `particle ${type}`;
                document.getElementById('canvas').appendChild(this.element);
            }

            update() {
                this.progress += this.speed;
                if (this.progress >= 1) {
                    this.element.remove();
                    return false;
                }

                const canvas = document.getElementById('canvas');
                const canvasRect = canvas.getBoundingClientRect();
                const fromRect = this.fromEl.getBoundingClientRect();
                const toRect = this.toEl.getBoundingClientRect();

                const x1 = fromRect.left + fromRect.width / 2 - canvasRect.left;
                const y1 = fromRect.top + fromRect.height / 2 - canvasRect.top;
                const x2 = toRect.left + toRect.width / 2 - canvasRect.left;
                const y2 = toRect.top + toRect.height / 2 - canvasRect.top;

                // Bezier curve interpolation
                const t = this.progress;
                const midY = (y1 + y2) / 2;
                const x = Math.pow(1-t, 3) * x1 + 3 * Math.pow(1-t, 2) * t * x1 + 3 * (1-t) * t * t * x2 + Math.pow(t, 3) * x2;
                const y = Math.pow(1-t, 3) * y1 + 3 * Math.pow(1-t, 2) * t * midY + 3 * (1-t) * t * t * midY + Math.pow(t, 3) * y2;

                this.element.style.left = `${x - 3}px`;
                this.element.style.top = `${y - 3}px`;
                return true;
            }
        }

        let particles = [];

        function spawnParticles() {
            connections.forEach(conn => {
                if (Math.random() > 0.7) {
                    particles.push(new Particle(conn.from, conn.to, conn.type));
                }
            });
        }

        function updateParticles() {
            particles = particles.filter(p => p.update());
        }

        // Animate metrics
        function animateMetrics() {
            // Randomize values slightly
            const mdRate = (1.1 + Math.random() * 0.2).toFixed(1);
            document.getElementById('md-rate').textContent = `${mdRate}M`;

            const orderRate = Math.floor(800 + Math.random() * 100);
            document.getElementById('order-rate').textContent = orderRate;

            const omsQueue = Math.floor(200 + Math.random() * 100);
            document.getElementById('oms-queue').textContent = omsQueue;

            const meMatches = Math.floor(4000 + Math.random() * 1000).toLocaleString();
            document.getElementById('me-matches').textContent = meMatches;

            const riskRejects = Math.floor(20 + Math.random() * 10);
            document.getElementById('risk-rejects').textContent = riskRejects;

            const dbWrites = Math.floor(10 + Math.random() * 5) + 'k';
            document.getElementById('db-writes').textContent = dbWrites;

            const throughput = Math.floor(800000 + Math.random() * 100000).toLocaleString();
            document.getElementById('throughput').textContent = throughput;
        }

        // Throughput chart
        function initThroughputChart() {
            const chart = document.getElementById('throughputChart');
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'throughput-bar-item';
                bar.style.height = `${20 + Math.random() * 80}%`;
                chart.appendChild(bar);
            }
        }

        function updateThroughputChart() {
            const bars = document.querySelectorAll('.throughput-bar-item');
            bars.forEach(bar => {
                bar.style.height = `${20 + Math.random() * 80}%`;
            });
        }

        // Incident simulation
        let incidentActive = false;

        function triggerIncident() {
            incidentActive = true;
            document.getElementById('incidentStatus').style.display = 'flex';
            document.getElementById('incidentOverlay').classList.add('visible');

            // Highlight affected nodes
            const affected = ['risk-engine', 'oms', 'ems', 'matching-engine'];
            affected.forEach((id, i) => {
                const node = document.querySelector(`[data-id="${id}"]`);
                node.classList.add('affected', `cascade-${i + 1}`);
            });

            // Update risk engine latency
            document.getElementById('risk-latency').textContent = '12.4ms';
            document.getElementById('risk-latency').className = 'metric-value critical';

            // Resolve after 10 seconds
            setTimeout(resolveIncident, 10000);
        }

        function resolveIncident() {
            incidentActive = false;
            document.getElementById('incidentStatus').style.display = 'none';
            document.getElementById('incidentOverlay').classList.remove('visible');

            document.querySelectorAll('.node.affected').forEach(node => {
                node.classList.remove('affected', 'cascade-1', 'cascade-2', 'cascade-3', 'cascade-4');
            });

            document.getElementById('risk-latency').textContent = '4.2ms';
            document.getElementById('risk-latency').className = 'metric-value warning';
        }

        // Main animation loop
        function animate() {
            updateParticles();
            requestAnimationFrame(animate);
        }

        // Initialize
        window.addEventListener('load', () => {
            drawConnections();
            initThroughputChart();
            animate();

            // Spawn particles regularly
            setInterval(spawnParticles, 100);

            // Update metrics
            setInterval(animateMetrics, 1000);

            // Update throughput chart
            setInterval(updateThroughputChart, 500);

            // Trigger incident periodically for demo
            setTimeout(triggerIncident, 8000);
            setInterval(() => {
                if (!incidentActive) {
                    setTimeout(triggerIncident, Math.random() * 20000);
                }
            }, 30000);
        });

        // Redraw on resize
        window.addEventListener('resize', drawConnections);
    </script>
</body>
</html>
